<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    关于sed我常用的几个方法以及遇到坑的整理 |
    
    烛影小札</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  <article id="post-sed-usage" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      关于sed我常用的几个方法以及遇到坑的整理
    </h1>
  

      </header>
    

    
      <div class="article-meta">
        <a href="/sed-usage/" class="article-date">
  <time datetime="2019-04-25T07:19:03.000Z" itemprop="datePublished">2019-04-25</time>
</a>
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

      </div>
    

    <div class="article-entry" itemprop="articleBody">
      

      

      
        <p><strong>注：以下用法如果用到 </strong>-i<strong> 参数 ，直接修改读取的文件内容，而不是输出到终端（危险动作）</strong></p>
<h2 id="显示"><a href="#显示" class="headerlink" title="显示"></a>显示</h2><h3 id="1-以行为单位的显示"><a href="#1-以行为单位的显示" class="headerlink" title="1. 以行为单位的显示"></a>1. 以行为单位的显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;5,7p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h3 id="2-搜寻关键词显示"><a href="#2-搜寻关键词显示" class="headerlink" title="2. 搜寻关键词显示"></a>2. 搜寻关键词显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/baird/p&apos; demo.txt</span><br></pre></td></tr></table></figure>
<p><strong>-n ：使用安静(silent)模式</strong><br><strong>p ：列印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行</strong><br>关于指定内容搜寻并显示也可尝试选择<strong>grep</strong>命令，更好明白一点，<a href="https://linux.cn/article-5453-1.html" target="_blank" rel="noopener">例子在这。</a></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>两种方式与上面显示同理，只需将<strong> p </strong>改成<strong> d </strong></p>
<h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><p>增加有两种方式：<br><strong>a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)<br>i ：插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)</strong></p>
<h3 id="1-以行为单位的新增"><a href="#1-以行为单位的新增" class="headerlink" title="1. 以行为单位的新增"></a>1. 以行为单位的新增</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;2a  new_line&apos; demo.txt</span><br></pre></td></tr></table></figure>
<p>2表示第二行，也可用2,5a表示二到五行</p>
<h3 id="2-搜寻关键词新增"><a href="#2-搜寻关键词新增" class="headerlink" title="2. 搜寻关键词新增"></a>2. 搜寻关键词新增</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;/baird/i  new_line&apos; demo.txt</span><br></pre></td></tr></table></figure>
<h2 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h2><h3 id="1-以行为单位的替换"><a href="#1-以行为单位的替换" class="headerlink" title="1. 以行为单位的替换"></a>1. 以行为单位的替换</h3><p><strong>c ： 取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！倒是跟上面的新增差不多</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;2,5c No 2-5 number&apos; demo.txt</span><br></pre></td></tr></table></figure></p>
<h3 id="2-搜寻关键词替换"><a href="#2-搜寻关键词替换" class="headerlink" title="2. 搜寻关键词替换"></a>2. 搜寻关键词替换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;s/要被取代的字串/新的字串/g</span><br></pre></td></tr></table></figure>
<p><strong>s: 每行，也可以选择固定在哪几行 <code>1,20s/old/new/g</code><br>g: 一行上替换所有的匹配，不加表示只替换第一个，2表示替换第二个（场景很少）</strong></p>
<h2 id="多点编辑"><a href="#多点编辑" class="headerlink" title="多点编辑"></a>多点编辑</h2><p>用的场景不多，sed写于shell脚本中，多写几行就是了</p>
<p><code>-e是编辑命令，用于sed执行多个编辑任务的情况下。在下一行开始编辑前，所有的编辑动作都将应用到模式缓冲区中的行上。因为是逐行进行多重编辑（即每个命令都在模式空间的当前行上执行），所以编辑命令的顺序会影响结果</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e action1 -e action2</span><br></pre></td></tr></table></figure>
<h2 id="记录自己遇到的几个坑问题"><a href="#记录自己遇到的几个坑问题" class="headerlink" title="记录自己遇到的几个坑问题"></a>记录自己遇到的几个坑问题</h2><h3 id="1-单双引号"><a href="#1-单双引号" class="headerlink" title="1. 单双引号"></a>1. 单双引号</h3><p>自己平常用到sed的场景一般都在shell中，自动化一些按部就班的东西，比如上一篇博文的自动生成django，在配置settings文件的时候难免修改或者增加一些设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;/ALLOWED_HOSTS/c ALLOWED_HOSTS = \[&apos;\&apos;&apos;*&apos;\&apos;&apos;\]&apos; setting.py</span><br></pre></td></tr></table></figure>
<p>注意到跟在sed后面的命令是用单引号的，如果我增加的文本中有本身有单引号，比如<code>ALLOWED_HOSTS = [&#39;*&#39;]</code>，那么我们需要用<code>&#39;\&#39;&#39;</code>来表示单引号，当然还有一些其他方法比如啥十六进制<code>\x27</code>，记不太清了，但是这个一些太乱了。后来发现个更好的方法：<br><code>sed -i &quot;/ALLOWED_HOSTS/c ALLOWED_HOSTS = \[\&#39;*\&#39;\]&quot; settings.py</code><br>用双引号括起来，这样里面的单引号用转义符号表示<code>\&#39;</code>,简洁多了。</p>
<p>双引号还有个好处，就是里面可以直接更shell中的变量$xx<br>比如之前我是这么写的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;/MIDDLEWARE/i LOCAL_APPS = \[&apos;\&apos;&apos;&apos;$app_name&apos;&apos;\&apos;&apos;\] \n&apos; $Filename</span><br></pre></td></tr></table></figure></p>
<p>可以直接这么写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;/MIDDLEWARE/i LOCAL_APPS = \[\&apos;$app_name\&apos;\] \n&quot; $Filename</span><br></pre></td></tr></table></figure></p>
<p><strong>所以遇到修改单引号或者了要用变量时，尽量用双引号来操作<code>sed</code>
</strong></p>
<h3 id="2-新增一行时增加空格或者Tab"><a href="#2-新增一行时增加空格或者Tab" class="headerlink" title="2. 新增一行时增加空格或者Tab"></a>2. 新增一行时增加空格或者Tab</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;/common/i \    \&apos;corsheaders.middleware.CorsMiddleware\&apos;,&quot; $Filename</span><br></pre></td></tr></table></figure>
<p>需要在i后面加一个<code>\</code>然后在加<code>\t</code>或者按几个空格</p>
<h3 id="3-替换时如果变量里有"><a href="#3-替换时如果变量里有" class="headerlink" title="3.替换时如果变量里有/"></a>3.替换时如果变量里有/</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s/youdir/$Shell_folder/g&quot;</span><br></pre></td></tr></table></figure>
<p>达不到自己想要的状态，当遇到情况时可以选择整行替代!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fantasyhh.github.io/sed-usage/" data-id="cjuwg340j0002p6mu6lc09wpw" class="article-share-link">Share</a>
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/">Shell</a></li></ul>

    </footer>

  </div>

  
    
  <nav class="article-nav">
    
    
      <a href="/auto-django/" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">Shell脚本自动生成django项目结构并添加常用插件</div>
      </a>
    
  </nav>


  

  
    
  

</article>



</section>
  <footer class="footer">
  
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2019 烛影小札</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>

<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="烛影小札"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>

<nav class="navbar navbar-bottom">
  <ul class="nav">
      <li class="nav-item">
          <div class="totop" id="totop">
    <i class="fe fe-rocket"></i>
</div>
      </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>

<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/ocean.js"></script>

</body>
</html>